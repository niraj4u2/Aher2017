<!DOCTYPE html>
<html>
<head>
<title>Aher Book</title>
<meta http-equiv="content-type" accept-charset = "utf-8" content="text/html; charset=utf-8" />
	<!-- <link href="css/kendo.common.min.css" rel="stylesheet"> -->
	<link rel="stylesheet" href="css/kendo.common-bootstrap.min.css" />
	<link href="css/kendo.bootstrap.min.css" rel="stylesheet">
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<!-- <link href="css/kendo.default.min.css" rel="stylesheet"> -->
	<link href="css/kendo.mobile.nova.min.css" rel="stylesheet">
	<link href="css/font-awesome.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/adsSlider.css">
	<link rel="stylesheet" href="css/loadimg.css" type="text/css">
	<!--<link rel="stylesheet" href="css/swiper.min.css">-->
 
	</head>
		<body class="pagebg">
			<div data-role="layout" data-id="default">
<header data-role="header">
<div data-role="navbar" class="TopBarLink">
<span data-role="view-title"></span>
<a class="about-button km-widget km-button" data-align="left" href="#" id="menu-link">
<i class="fa fa-bars"></i></a>
<a class="about-button topbarLogo" data-align="left" href="#/" data-role="button">
<!-- <img src="images/barlogo.png" alt=""/> -->आहेर Book
</a>
<!--<a class="about-button searchBtn" data-align="right" href="#">
<form class="searchbox">
        <input type="search" placeholder="Search......" name="search" class="searchbox-input" onKeyUp="buttonUp();" required>
        <input type="submit" class="searchbox-submit" value="GO">
        <span class="searchbox-icon"><i class="fa fa-search"></i></span>
</form></a>-->
<a class="about-button searchBtn" data-align="right" href="#">
<i class="fa fa-search"></i></a>
<a class="about-button" data-align="right" href="index.html" data-role="button" data-rel="external">
<i class="fa fa-home"></i></a>
</div>
<section class="searchShow" style="display:none;">
<input id="appsearch" type="text" class="k-textbox" placeholder="Search ....." style="width: 100%;" />
</section>
</header>
 
</div>
<!-- End Template -->

<div data-role="view" data-layout="default" id="index" class="content-container">
<div class="">
<div class="col-lg-12 p0">
<section class="well user_profile mb0" id="profile">
<div class="media">
<div class="left_profile media-left" class="media-left">
 <i class="camera-icon">&nbsp;</i>
    <label id="upload">
			<input type="file" id="profileupload">
    </label>
</div>

<div class="media-body">
	<span id="profile_name" class="ra-first-name">Hi, ....</span>
	<div class="ra-position">Welcome to आहेर Book</div>
</div>
</div>
</section>
</div>
                
</div>
			
<section class="p15">
 

<div class="whiteBox aherBookPart">
<h3 class="ra-first-name">User Profile</h3>
<div class="media scanPart">
 

<div class="media-body">
	
	<span class="error" id="flash_message"></span>

	<form id="" name="user_profile" required method="post" > 
		 <div class="panel-body">
							<div class="row">
								
								<div class="col-lg-12">
									<div class="form-group">
										<label>Title</label>
										<select class="selectpicker form-control" data-live-search="true" tabindex="1" name="title" id="title" required>
											<option value="" selected="">Select Title</option>
											<option value="Miss">Miss</option>
											<option value="Mrs.">Mrs.</option>
											<option value="Mr.">Mr.</option>
											<option value="Ma'am">Ma'am</option>
										</select>
									</div>
									<div class="form-group">
										<label>First Name</label>
										<input name="first_name"  id="first_name" tabindex="2" value="" class="form-control" placeholder="First Name" required >
									</div>
									
									<div class="form-group">
										<label>Middel Name</label>
										<input name="middle_name" id="middle_name" tabindex="3" value="" class="form-control" placeholder="Middle Name" required>
									</div>
									 <div class="form-group">
										<label>Last Name</label>
										<input name="last_name"  id="last_name" tabindex="4" value="" class="form-control" placeholder="Last Name" required>
									</div>
									 <div class="form-group">
										<label>User Name</label>
										<input name="user_name" id="user_name"  tabindex="9" readonly class="form-control" placeholder="User Id" required>
									</div>
									
									<div class="form-group">
										<label>Mobile Number</label>
										<input name="phone" id="phone"  tabindex="9" maxlength="10" value="" class="form-control" placeholder="Mobile Number" required>
									</div>
									<div class="form-group">
										<label>Email</label>
										<input name="email" id="email"  tabindex="9" readonly class="form-control" placeholder="Email" required>
									</div>
									
									 
									
								</div>
								 
								
								<div class="col-lg-12">
								<div class="form-group">
									<div class="col-sm-4 col-sm-offset-2">
										  
										<button class="k-button k-primary" id="update_profile" type="submit">Save</button>
									</div>
								</div>
								</div>
							
							</div>
						</div> 
</form>
</div>
</div>
</div>
	


</section>

<div class="clearfix"></div>
  
</div>

<div id="menu-content" style="display:none;">
	<a href="#" class="closemenu-link">
		<i class="fa fa-close"></i>
	</a>
	<div class="header_bar">
		<div class="col-lg-12 p0">
			<section class="well mb0" id="profile">
				<div class="media">
					<div  class="left_profile" class="media-left">
						</div>
						<div class="media-body">
							<img alt="" src="images/barlogo.png" class="km-image">
							</div>
						</div>
					</section>
				</div>
			</div>
			 <ul>
				<li> <a  id="logout" href="javascript:void(0);"> <i class="fa fa-lock"></i> Logout </a> </li>
				<li> <a href="index.html"> <i class="fa fa-home"></i> Home </a> </li>
				 <li> <a href="qrcode_list.html"> <i class="fa fa-qrcode"></i> QR Code </a> </li>
				 <li> <a href="qrcode.html"> <i class="fa fa-qrcode"></i> QR Code Generate </a></li>
				 <li><a href="advertise.html"><i class="fa fa-bullhorn"></i> Advertise</a></li>
				 <li><a href="profile_update.html"><i class="fa fa-user"></i> User Detail</a></li>
				 <li><a href="change_password.html"><i class="fa fa-unlock-alt"></i> Change Password</a></li>
			</ul>
</div>

<script src="js/jquery-1.9.1.min.js"></script>
 <script src="cordova.js"></script>
 <script src="kendo/js/kendo.mobile.min.js"></script>
<script src="scripts/demo.js"></script>
<script src="scripts/app.js"></script>
<script src="js/kendo.all.min.js"></script>
<script src="js/modernizr.js"></script>
<script src="js/jquery.cookie.js"></script>
<script src="js/main.js"></script>
<script src="js/config.js"></script>
<script src="js/localdb.js"></script>
<script src="js/loadimg.min.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
	$('.left_profile #upload').loadImg({
		"fileExt"		: ["png","jpg"],
		"fileSize_min"	: 0,
		"fileSize_max"	: 6
	});
	
	$("form").submit(function(){
		var localUserData = JSON.parse(localStorage["user_data"]);
		resetErrors();
		var title =  $('#title').val() ;
		var middle_name =  $('#middle_name').val();
		var first_name =  $('#first_name').val();
		var last_name =    $('#last_name').val();
		var phone =   $('#phone').val();
					
		$.ajax({
				url:BaseUrl+"update_user",
				type: 'post',
				data: {
					user_id: localUserData.id ,
					title: title ,
					middle_name: middle_name,
					first_name: first_name,
					last_name:  last_name,
					phone:  phone
					 
				  },
				success: function(data) {
					
					if(data.status==1){
							$('#update_profile').html('Updating..');
							 	
							$('#loader').css('display','none'); 
							$('#flash_message').html('<div class="alert alert-success"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>Your profile have been successfully Updated.</div>');
							// update profile in local system
							localUserData.title= title;
							localUserData.middle_name= middle_name;
							localUserData.last_name= last_name;
							localUserData.first_name= first_name;
							localUserData.phone= phone;
							localStorage["user_data"] = JSON.stringify(localUserData);
							 return false;
							 
							
						}else if(data.status==0){
							$('#update_profile').prop('disabled', false); 
				
							if(jQuery.type(data.message)=='string'){
								$('#flash_message').html('<div class="alert alert-danger"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+data.message+'</div>');
							}else{
								$.each(data.message,function(field_name,msg){
									var msg_data = '<label class="error" for="'+field_name+'">'+msg+'</label>';
									$('input[name="' + field_name + '"], select[name="' + field_name + '"]').addClass('inputTxtError').after(msg_data);
						
								});	
							}
								$('#loader').css('display','none'); 
						}else{
								$('#flash_message').html('<div class="alert alert-danger"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>Server down</div>');
								$('#loader').css('display','none');
							}  
				},
				 
				error: function(data) {
					$('#flash_message').html('<div class="alert alert-danger"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>Please check your internet connection</div>');
					 
				},
				 
			})
			$('#update_profile').html('Save');
		return false;
	});
	
	
  });
	//var user_data  =$.parseJSON($.cookie("UserData")); 

$(function() {
        $("#menu-content").kendoMobileDrawer({
            container: ".content-container"
        });

         $("#menu-link").click(function() {
            $("#menu-content").data("kendoMobileDrawer").show();
			//$('#menu-content').hide('slide', {direction: 'left'}, 1000);
            return false;
        });

        $(".closemenu-link").click(function() {
            $("#menu-content").data("kendoMobileDrawer").hide();
            return false;
        });

    });
	
$(document).ready(function () {
var app;
app = new kendo.mobile.Application($(document.body), { transition: "slide" });
 // image upload 
  $("#profileupload").change(function() {
		setTimeout(image_load, 1000)
	});
 
 
});		
 setTimeout(function(){ 
	 
	 $("#scanner").attr("data-role", "views");
	 $("#scanner").attr("class", "km-widget x-view");
	 $('#scanner').show();
	 $('#class').show();

 }, 200);
 function image_load(){
	 var pf_img = ($('#upload img').attr('src'));
	 var localUserData = JSON.parse(localStorage["user_data"]);
	
	  $.ajax({
					url:BaseUrl+"update_profile_image",
					type: 'post',
					data: {
						image: pf_img,
						user_id: localUserData.id
						 
					  },
					success: function(data) {
						 $('#flash_message').html('<div class="alert alert-success"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>Your profile image has been successfully Updated </div>');
						 profile_update(pf_img );
					},
					 
					error: function(data) {
						$('#flash_message').html('<div class="alert alert-danger"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>Please check your internet connection</div>');
						 
					},
					 
				})
 }
 function profile_update(value ){
		 
	   var localUserData = JSON.parse(localStorage["user_data"]);
   // console.log(localUserData.field); 
	   localUserData.image= value;
	   localStorage["user_data"] = JSON.stringify(localUserData);
 }
 		 
 function resetErrors() {
		$('form input, form select').removeClass('inputTxtError');
		$('#flash_message').html('');
		$('label.error').remove();
	}
	
	
 //$("#appsearch").kendoAutoComplete({
   //                     dataSource: data,
    //                    filter: "startswith",
       //                 placeholder: "Search .....",
                        //separator: ", "
	//});
 
 

//var swiper = new Swiper('.swiper-container');
</script> 


</body>
</html> 
